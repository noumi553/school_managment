<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Sheet Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .table-responsive {
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Admin Control Panel</a>
        </div>
    </nav>

    <!-- Create Date Sheet Form -->
    <div class="container mt-5">
        <h2 class="mb-4 text-center">Create Date Sheet</h2>
        <form id="createForm">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>Date</th>
                            <th>Subject</th>
                            <th>Time</th>
                            <th>Class</th>
                            <th>Teacher Name</th>
                            <th>Paper Style</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="date" name="date" class="form-control" required></td>
                            <td><input type="text" name="subject" class="form-control" required></td>
                            <td><input type="text" name="time" class="form-control" required></td>
                            <td><input type="text" name="class" class="form-control" required></td>
                            <td><input type="text" name="teacherName" class="form-control" required></td>
                            <td>
                                <select name="style" class="form-select" required>
                                    <option value="Objective">Objective</option>
                                    <option value="Subjective">Subjective</option>
                                    <option value="Both">Both</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="text-center">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
    </div><br>

    <!-- View Table -->
    <div class="container">
        <h4 class="text-center mb-3">View Date Sheet by Class</h4>
        <select id="select" class="form-select mb-3">
            <option value="one" selected>Select the class</option>
            <option value="one">Class one</option>
            <option value="two">Class two</option>
            <option value="three">Class three</option>
            <option value="four">Class four</option>
            <option value="five">Class five</option>
            <option value="six">Class six</option>
            <option value="seven">Class seven</option>
            <option value="eight">Class eight</option>
            <option value="nine">Class nine</option>
            <option value="ten">Class ten</option>
        </select>

        <div class="table-responsive">
            <table class="table table-bordered" id="dateSheetTable" style="display: none;">
                <thead class="table-dark">
                    <tr>
                        <th>Date</th>
                        <th>Subject</th>
                        <th>Time</th>
                        <th>Class</th>
                        <th>Teacher Name</th>
                        <th>Paper Style</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="tabel"></tbody>
            </table>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="updateModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="updateForm">
                    <div class="modal-header">
                        <h5 class="modal-title">Update Date Sheet</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="updateId">
                        <input type="date" class="form-control mb-2" id="updateDate" required>
                        <input type="text" class="form-control mb-2" id="updateSubject" required>
                        <input type="text" class="form-control mb-2" id="updateTime" required>
                        <input type="text" class="form-control mb-2" id="updateClass" required>
                        <select class="form-select mb-2" id="updateStyle" required>
                            <option value="Objective">Objective</option>
                            <option value="Subjective">Subjective</option>
                            <option value="Both">Both</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-warning">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-5">
        &copy; 2025 Bright Future School. All rights reserved.
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let allData = [];

        function fetchDataAndRender(classVal = '1') {
            fetch('http://localhost:4000/dateSheetTable')
                .then(res => res.json())
                .then(data => {
                    allData = data;
                    renderTable(classVal);
                })
                .catch(console.error);
        }

        function renderTable(classVal) {
            const rows = allData
                .filter(d => d.class === classVal)
                .map(d => `
                    <tr>
                        <td>${new Date(d.date).toLocaleDateString()}</td>
                        <td>${d.subject}</td>
                        <td>${d.time}</td>
                        <td>${d.class}</td>
                        <td>${d.teacherName}</td>
                        <td>${d.style}</td>
                        <td>
                            <button class="btn btn-sm btn-warning me-1" onclick='openUpdateModal(${JSON.stringify(d)})'>Update</button>
                            <button class="btn btn-sm btn-danger" onclick='deleteDateSheet("${d._id}", "${d.class}")'>Delete</button>
                        </td>
                    </tr>`
                ).join('');
            document.getElementById('tabel').innerHTML = rows;
            document.getElementById('dateSheetTable').style.display = rows ? 'table' : 'none';
        }

        document.getElementById('select').addEventListener('change', e => renderTable(e.target.value));

        document.getElementById('createForm').addEventListener('submit', e => {
            e.preventDefault();
            const form = e.target;
            const formData = Object.fromEntries(new FormData(form));
            fetch('http://localhost:4000/dateSheet', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
                .then(() => {
                    alert('Created!');
                    form.reset();
                    fetchDataAndRender(formData.class);
                });
        });

        function openUpdateModal(data) {
            document.getElementById('updateId').value = data._id;
            document.getElementById('updateDate').value = new Date(data.date).toISOString().split('T')[0];
            document.getElementById('updateSubject').value = data.subject;
            document.getElementById('updateTime').value = data.time;
            document.getElementById('updateClass').value = data.class;
            document.getElementById('updateStyle').value = data.style;
            new bootstrap.Modal(document.getElementById('updateModal')).show();
        }

        document.getElementById('updateForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const id = document.getElementById('updateId').value;
            const data = {
                date: document.getElementById('updateDate').value,
                subject: document.getElementById('updateSubject').value,
                time: document.getElementById('updateTime').value,
                class: document.getElementById('updateClass').value,
                style: document.getElementById('updateStyle').value
            };

            fetch(`http://localhost:4000/updateDateSheet/${id}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
                .then(() => {
                    alert('Updated!');
                    fetchDataAndRender(data.class);
                });
        });

        function deleteDateSheet(id, classVal) {
            if (confirm('Are you sure you want to delete this entry?')) {
                fetch(`http://localhost:4000/deleteDateSheet/${id}`, {
                    method: 'DELETE'
                })
                    .then(() => {
                        alert('Deleted!');
                        fetchDataAndRender(classVal);
                    });
            }
        }

        fetchDataAndRender();
    </script>
</body>

</html>
