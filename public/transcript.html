<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <title>Student Info</title>
    <style>
        #image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }
        .status-pass {
            color: green;
            font-weight: bold;
        }
        .status-fail {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">School Management</a>
    </div>
</nav>

<div class="container my-4" id="studentInfoContainer">
    <!-- Student Info Table -->
</div>

<div class="container" id="marksContainer">
    <!-- Exam Marks Tables -->
</div>

<script>
    const studentInfoContainer = document.getElementById('studentInfoContainer');
    const marksContainer = document.getElementById('marksContainer');

    fetch('http://localhost:4000/studentApi', {
        credentials: 'include'
    })
    .then(res => res.json())
    .then(data => {
        // Student Info Table
        const infoTable = document.createElement('table');
        infoTable.classList.add('table', 'table-bordered', 'text-center', 'align-middle');

        const infoThead = document.createElement('thead');
        infoThead.innerHTML = `
            <tr class="table-dark">
                <th colspan="2">Student Information</th>
            </tr>
        `;
        infoTable.appendChild(infoThead);

        const infoTbody = document.createElement('tbody');
        infoTbody.innerHTML = `
            <tr>
                <td><strong>Image</strong></td>
                <td><img src="${data?.signup?.image?.imagePath || 'default.png'}" alt="Student Image" id="image" /></td>
            </tr>
            <tr>
                <td><strong>Name</strong></td>
                <td>${data.name}</td>
            </tr>
            <tr>
                <td><strong>Email</strong></td>
                <td>${data.email}</td>
            </tr>
            <tr>
                <td><strong>Village</strong></td>
                <td>${data.village}</td>
            </tr>
            <tr>
                <td><strong>Class</strong></td>
                <td>${data.class}</td>
            </tr>
        `;
        infoTable.appendChild(infoTbody);
        studentInfoContainer.appendChild(infoTable);

        // Subjects by class
        const allMarks = data.mark || [];
        let subjects = [];
        if (data.class === "four" || data.class === "five" || data.class === "three" || data.class === "one" || data.class === "two" || data.class === "six" || data.class === "seven") {
            subjects = ['science', 'english', 'maths', 'urdu', 'pakStudy', 'islamyat'];
        } else if (data.class === "ten" || data.class === "nine" || data.class === "eight") {
            subjects = ['physics', 'english', 'maths', 'urdu', 'pakStudy', 'islamyat', 'biology', 'chemistry'];
        }

        if (allMarks.length === 0) {
            marksContainer.innerHTML = '<p class="text-muted">No marks available.</p>';
            return;
        }

        // Create tables for each term
        allMarks.forEach(term => {
            const tableDiv = document.createElement('div');
            tableDiv.classList.add('mb-4', 'table-responsive');
            console.log(term)

            const table = document.createElement('table');
            table.classList.add('table', 'table-bordered', 'table-striped', 'text-center', 'align-middle');

            const caption = document.createElement('caption');
            caption.classList.add('text-center', 'fw-bold');
            caption.textContent = term.title || 'Exam Marks';
            table.appendChild(caption);

            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr class="table-dark">
                    <th>Subject</th>
                    <th>Marks</th>
                </tr>
            `;
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            let totalMarks = 0;
            let subjectCount = 0;

            subjects.forEach(subject => {
                const markStr = term[subject] ?? '0';
                const markNum = parseInt(markStr) || 0;

                totalMarks += markNum;
                subjectCount++;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${subject.charAt(0).toUpperCase() + subject.slice(1)}</td>
                    <td>${markStr}</td>
                `;
                tbody.appendChild(row);
            });

            // Total
            tbody.innerHTML += `
                <tr>
                    <td><strong>Total Marks</strong></td>
                    <td><strong>${totalMarks}</strong></td>
                </tr>
            `;

            // Percentage
            const percentage = subjectCount > 0 ? (totalMarks / (subjectCount * 100)) * 100 : 0;
            const percFixed = percentage.toFixed(2);
            tbody.innerHTML += `
                <tr>
                    <td><strong>Percentage</strong></td>
                    <td><strong>${percFixed}%</strong></td>
                </tr>
            `;

            // Status
            const isPass = percentage >= 40;
            tbody.innerHTML += `
                <tr>
                    <td><strong>Status</strong></td>
                    <td class="${isPass ? 'status-pass' : 'status-fail'}">${isPass ? 'Pass' : 'Fail'}</td>
                </tr>
            `;

            table.appendChild(tbody);
            tableDiv.appendChild(table);
            marksContainer.appendChild(tableDiv);
        });
    })
    .catch(err => {
        console.error('Error fetching student data:', err);
        studentInfoContainer.innerHTML = '<p class="text-danger">Failed to load student data.</p>';
    });
</script>
</body>
</html>
